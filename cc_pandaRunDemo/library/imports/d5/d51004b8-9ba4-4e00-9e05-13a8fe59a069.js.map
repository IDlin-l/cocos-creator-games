{
  "version": 3,
  "sources": [
    "unknown"
  ],
  "names": [],
  "mappings": "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",
  "file": "unknown",
  "sourcesContent": [
    "\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        speed:cc.v2(0, 0),\n        addSpeed: 600,\n        maxSpeed: cc.v2(10, 1000),\n        gravity: -1000,\n        jumpSpeed: 300,\n        collisionX: 0,\n        collisionY: 0,\n        direction: 0, //控制的方向，只有左右\n        jumping: false,\n        jumpCount: 0, //跳跃次数\n        drag: 1000,\n        prePosition:cc.v2(0,0), //上一帧的坐标\n        player: null, // 动画播放器\n\n        // //外部组件\n        uiLayer: cc.Node,\n        uiLayerComonent: null,\n    },\n\n    // use this for initialization\n    onLoad: function () {\n       this.prePosition.x = this.node.x;\n       this.prePosition.y = this.node.y;\n\n       var manager = cc.director.getCollisionManager();\n       manager.enabled = true;\n    //    manager.enabledDebugDraw = true;\n\n        this.player = this.node.getComponent(cc.Animation);\n\n        //UI组件\n        this.uiLayerComonent = this.uiLayer.getComponent(\"uiLayer\");\n\n       cc.eventManager.addListener({\n            event: cc.EventListener.KEYBOARD,\n            onKeyPressed: this.onKeyPressed.bind(this),\n            onKeyReleased: this.onKeyReleased.bind(this)\n        }, this.node);\n    },\n\n    onDestroy: function onDisabled() {\n        cc.director.getCollisionManager().enabled = false;\n        cc.director.getCollisionManager().enabledDebugDraw = false;\n    },\n\n    onKeyPressed: function (keyCode, event) {\n        switch (keyCode) {\n            case cc.KEY.d:\n                this.direction = 1;\n\n                if (!this.jumping) this.player.play(\"run\");    \n                break;\n            case cc.KEY.a:\n                this.direction = -1;\n                if (!this.jumping) this.player.play(\"run\");   \n\n                break;\n            case cc.KEY.j:\n                if (!this.jumping || this.jumpCount < 2) {\n                    this.jumping = true;\n                    this.speed.y = this.jumpSpeed;\n\n                    this.jumpCount++;\n                    this.jumpCount < 2 ? this.player.play(\"jump\") : this.player.play(\"twiceJump\");\n                }\n                break;\n        }\n    },\n\n    onKeyReleased: function (keyCode, event) {\n         switch (keyCode) {\n            case cc.KEY.d:\n                if (this.direction == 1) {\n                    this.direction = 0;\n                }\n                break;\n            case cc.KEY.a:\n                if (this.direction == -1) {\n                    this.direction = 0;\n                }\n                break;\n         }\n    },\n\n    collisionGoldEnter: function (other, self) {\n        other.node.removeFromParent();\n\n        this.uiLayerComonent.addGold();\n    },\n    \n\n    collisionPlatformEnter: function (other, self) {\n        var selfAabb = self.world.aabb.clone();\n        var otherAabb = other.world.aabb;\n        var preAabb = self.world.preAabb;\n\n        selfAabb.x = preAabb.x;\n        selfAabb.y = preAabb.y;\n\n        //检查X是否发生碰撞\n        selfAabb.x = self.world.aabb.x;\n        if (cc.Intersection.rectRect(selfAabb, otherAabb)) {\n            if (this.speed.x < 0 && selfAabb.xMax > otherAabb.xMax) {\n                this.node.x = otherAabb.xMax;\n                this.collisionX = -1;\n            } else if (this.speed.x > 0 && selfAabb.xMin < otherAabb.xMin) {\n                this.node.x = otherAabb.xMin - selfAabb.width;\n                this.collisionX = 1;\n            }\n\n            this.speed.x = 0;\n            return;\n        }\n\n        //检查Y是否发生碰撞\n        selfAabb.y = self.world.aabb.y;\n        if (cc.Intersection.rectRect(selfAabb, otherAabb)) {\n            if (this.speed.y < 0 && selfAabb.yMax > otherAabb.yMax) {\n                this.node.y = otherAabb.yMax;\n                this.jumping = false;\n                this.player.play(\"run\");\n                this.jumpCount = 0;\n                this.collisionY = -1;\n            } else if (this.speed.y > 0 && selfAabb.yMin < otherAabb.yMin) {\n                this.node.y = otherAabb.yMin - selfAabb.height;\n                this.collisionY = 1;\n            }\n\n            this.speed.y = 0;\n        }\n    },\n\n    onCollisionEnter: function (other, self) {\n        console.log('on collision enter');\n        cc.log(\"coll tag = \" + other.tag);\n\n       if (other.tag == 1) {\n           this.collisionGoldEnter(other, self);\n       }\n       else{\n           this.collisionPlatformEnter(other, self);\n       }\n    },\n\n    onCollisionStay: function (other, self) {\n        // console.log('on collision stay');\n\n        if (other.tag != 0) return;\n        if (this.collisionY === -1) {\n            var offset = cc.v2(other.world.aabb.x - other.world.preAabb.x, 0);\n\n            // var temp = cc.affineTransformClone(self.world.transform);\n            // temp.tx = temp.ty = 0;\n\n            // offset = cc.pointApplyAffineTransform(offset, temp);\n            this.node.x += offset.x;\n        }\n    },\n    \n    /**\n     * 当碰撞结束后调用\n     * @param  {Collider} other 产生碰撞的另一个碰撞组件\n     * @param  {Collider} self  产生碰撞的自身的碰撞组件\n     */\n    onCollisionExit: function (other, self) {\n        console.log('on collision exit');\n        if (other.tag != 0) return;\n        \n        this.collisionX = 0;\n        this.collisionY = 0;\n        this.jumping = true;\n        this.jumpCount = 1;\n        this.player.play(\"jump\");\n    },\n    \n    // called every frame, uncomment this function to activate update callback\n    update: function (dt) {\n        /**\n         * Y轴变化\n         *  */ \n        if (this.collisionY === 0) //没任何碰撞，计算重力\n        {\n            this.speed.y += this.gravity * dt;\n            if (Math.abs(this.speed.y) > this.maxSpeed.y) \n            {\n                this.speed.y = this.speed.y > 0 ? this.maxSpeed.y : -this.maxSpeed.y;\n            }\n        } \n\n        if (this.direction === 0) {\n            //停下的时候，计算摩擦力 \n            if (this.speed.x > 0) {\n                this.speed.x -= this.drag * dt;\n                if (this.speed.x <= 0) this.speed.x = 0;\n            } else if (this.speed.x < 0) {\n                this.speed.x += this.drag * dt;\n                if (this.speed.x >= 0) this.speed.x = 0;\n            }\n        } else {\n            //左右速度行走,如果反方向，速度用更大的摩擦力，令方向更快改变\n            var trueDir = this.speed.x > 0 ? 1 : -1;\n            if (this.speed.x == 0) trueDir = 0;\n            var speed = (trueDir == this.direction ? this.addSpeed : 3000);\n\n            this.speed.x += (this.direction > 0 ? 1 : -1) * speed * dt;\n            if (Math.abs(this.speed.x) > this.maxSpeed.x) {\n                this.speed.x = this.speed.x > 0 ? this.maxSpeed.x : -this.maxSpeed.x;\n            }\n        }\n\n        //左右有碰撞,X立刻停下\n        if (this.speed.x * this.collisionX > 0) {\n            this.speed.x = 0;\n        }\n\n        this.prePosition.x = this.node.x;\n        this.prePosition.y = this.node.y;\n\n        this.node.x += this.speed.x * dt;\n        this.node.y += this.speed.y * dt;\n    },\n});\n"
  ]
}